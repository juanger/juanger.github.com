
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>HFS+ and Unicode madness - Ruby Xocolatl</title>
  <meta name="author" content="Juan Castaneda">

  
  <meta name="description" content="This is an old post that I wrote some while ago, but never published it. It is here just for historical|nostalgic|unburdening reasons. Original post &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.juanger.com/blog/2010/04/this-is-old-post-that-i-wrote-some/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="false" rel="alternate" title="Ruby Xocolatl" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
  if (window.location.host.split(":")[0] != 'localhost' && window.location.host != "blog.dev") {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3608240-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  }
  </script>


</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  <h1><a href="/">Ruby Xocolatl</a></h1>
  
    <h2>Ruby, Cocoa, Mac OS X and things of my not so exciting life.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.juanger.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/about">About me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">HFS+ and Unicode Madness</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-04-25T00:00:00-07:00" pubdate data-updated="true">Apr 25<span>th</span>, 2010</time>
        
      </p>
    
  </header>


<div class="entry-content"><div class='post'>
<div xmlns='http://www.w3.org/1999/xhtml'><p><strong>This is an old post that I wrote some while ago, but never published it. It is here just for historical|nostalgic|unburdening reasons. Original post begins here:</strong></p><p>Annoying scenario:</p><p>A file with unicode characters in its filename: Pétalo.java</p><br />
<script src="http://gist.github.com/489706.js?file=gistfile1.txt"></script><br />
<br />
<span id='fullpost'>  <p>Why? That’s easy, because Mac OS X java wants everything with MacRoman encoding (<span class='caps'>WTF</span>??). Then I tried with the -encoding flag and tab-autocompletion for the filename:</p><br />
<script src="http://gist.github.com/489709.js?file=gistfile1.txt"></script><br />
<br />
<p>That is not good. When using autocompletion the filename is represented in <span class='caps'>NFD</span> or Normalization Form Canonical Decomposition (é =&gt; 65 cc81) but the class name in the file uses <span class='caps'>NFC</span> or Normalization Form Canonical Composition (é =&gt; c3a9). What a mess! Do you see the difference?:</p><script src="http://gist.github.com/489712.js?file=gistfile1.txt"></script><br />
<p>You can’t see the difference until you see the actual bytes of the string, and that’s why Apple tries to protect us by storing everything in the Filesystem with the same representation: <span class='caps'>NFD</span>. The first echo was done with autocompletion while the latter was typed directly with the keyboard. So if I compile the java sourcecode by fully typing the filename, it succeeds.</p><h3>¿What about version control?</h3><p>Then, this leads to a major problem. When someone in the world (including you and me) creates a file, he types its name with the keyboard, which as I have showed, it gives <span class='caps'>NFC</span> in Mac OS X. But with <span class='caps'>HFS</span>, the file is stored using <span class='caps'>NFD</span> and if you clone a git repo created in another OS you’ll see that you have untracked files without modifying anything!!</p><h3><span class='caps'>UFS</span> to the rescue (kind of…)</h3><p>Maybe you could say “well, just use another filesystem”, and I’ve done that, but it seems that Apple uses it’s decomposition algorithms everywhere.</p><p>First I tried <span class='caps'>ZFS</span> as I thought “That FS should work correctly in <span class='caps'>OSX</span>, they can’t spoil it”. But I installed the read-write implementation from MacOS Forge and it did the same stupid conversion (<span class='caps'>UPDATE</span>: <span class='caps'>ZFS</span> is discontinued in MacOS Forge :( ).</p><p><span class='caps'>FAT</span> is a no-no since it only accepts <span class='caps'>ASCII</span> characters for the filename and I don’t want to start a remote server nor a Virtual Machine every time I have to work with those files. This should work with my beloved OS!! And in fact, I have successfully made everything I’ve needed to work in Mac OS, until now :(.</p><p>So I needed to try <span class='caps'>UFS</span>, I looked at DiskUtility, but it doesn’t support <span class='caps'>UFS</span> and newfs fails to format my external <span class='caps'>USB</span> disk.</p><p>But since I used hdiutil to create Pallet’s dmg, I thought of havin a <span class='caps'>UFS</span> diskimage and guess what, you can!! This is the magic command:</p><script src="http://gist.github.com/489715.js?file=gistfile1.txt"></script><br />
<p>Now I can mount my dmg, compile and use git!!</p><p>But still there are two little problems:</p><ul><li>Snow Leopard doesn’t support <span class='caps'>UFS</span>. I can’t even mount my <span class='caps'>UFS</span> disk image :(</li>
<li>Every app that uses Cocoa to open files can’t read files with <span class='caps'>NFC</span> filenames. This means “forget about TextMate”. Noooooooo!!</li>
</ul><h3>Update</h3><p>Now I’ve updated to Snow Leopard and is very disappointing and sad that I have to use a virtual machine to do my job.</p><p>The good thing is that I can work with TextMate via ssh and MacFusion.</p><p>Bad things: MacOS X can solve my problem, I can’t open files with <span class='caps'>NFC</span> names in TextMate (but emacs.app still loves me) and although it seems there are some people working with File Systems at Apple I think this won’t be solved anytime soon.</p></span> </div></div>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Juan Castaneda</span></span>

      








  


<time datetime="2010-04-25T00:00:00-07:00" pubdate data-updated="true">Apr 25<span>th</span>, 2010</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://blog.juanger.com/blog/2010/04/this-is-old-post-that-i-wrote-some/" data-via="juanger_" data-counturl="http://blog.juanger.com/blog/2010/04/this-is-old-post-that-i-wrote-some/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2009/07/one-week-till-midterm-evaluation/" title="Previous Post: One week till Midterm evaluation!">&laquo; One week till Midterm evaluation!</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/06/html5-and-css3-buttons/" title="Next Post: CSS3 styled buttons with compass">CSS3 styled buttons with compass &raquo;</a>
      
    </p>
  </footer>
</article>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Juan Castaneda -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
