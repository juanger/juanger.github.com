<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-3608240-2"></script><script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){window.dataLayer.push(arguments)}
                gtag("js", new Date());
                gtag("config", "UA-3608240-2");
            </script><title>Ruby Xocolatl</title><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="6"/><link rel="preload" href="/_next/static/Zpr3ES4ezugP2oyXxdtgy/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/Zpr3ES4ezugP2oyXxdtgy/pages/%5Blang%5D/%5Byear%5D/%5Bmonth%5D/%5Bslug%5D.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.c6faae2799416a6da8e8.js" as="script"/><link rel="preload" href="/_next/static/chunks/d6e0038b4b59f843086243a04f9222f0fd359ec2.2a93a51f7edfe8f800ec.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-c9247a71228c59dea69a.js" as="script"/><link rel="preload" href="/_next/static/chunks/d4e48a365f993d8a349754363dd2b4104bb8c17a.9bf74a4d22fce6e7182f.js" as="script"/><style id="__jsx-1504846400">header.jsx-1504846400{position:absolute;z-index:100;}header.jsx-1504846400 a.jsx-1504846400{font-size:1.2em;margin-right:15px;}header.jsx-1504846400 a.jsx-1504846400:hover{color:#111;}</style><style id="__jsx-2784478401">@charset "UTF-8";html{font-size:14px;}body{width:87.5%;margin-left:auto;margin-right:auto;padding-left:12.5%;font-family:Palatino,"Palatino Linotype","Palatino LT STD", "Book Antiqua",Georgia,serif;background-color:#fffff8;color:#111;max-width:1400px;counter-reset:sidenote-counter;}h1{font-weight:400;margin-top:4rem;margin-bottom:1.5rem;font-size:3.2rem;line-height:1;}h2{font-style:italic;font-weight:400;margin-top:2.1rem;margin-bottom:1.4rem;font-size:2.2rem;line-height:1;}h3{font-style:italic;font-weight:400;font-size:1.7rem;margin-top:2rem;margin-bottom:1.4rem;line-height:1;}hr{display:block;height:1px;width:55%;border:0;border-top:1px solid #ccc;margin:1em 0;padding:0;}p.subtitle{font-style:italic;margin-top:1rem;margin-bottom:1rem;font-size:1.8rem;display:block;line-height:1;}.numeral{font-family:et-book-roman-old-style;}.danger{color:red;}article{position:relative;padding:5rem 0rem;}section{padding-top:1rem;padding-bottom:1rem;}p,ol,ul{font-size:1.4rem;line-height:2rem;}p{margin-top:1.4rem;margin-bottom:1.4rem;padding-right:0;vertical-align:baseline;}div.epigraph{margin:5em 0;}div.epigraph>blockquote{margin-top:3em;margin-bottom:3em;}div.epigraph>blockquote,div.epigraph>blockquote>p{font-style:italic;}div.epigraph>blockquote>footer{font-style:normal;}div.epigraph>blockquote>footer>cite{font-style:italic;}blockquote{font-size:1.4rem;}blockquote p{width:55%;margin-right:40px;}blockquote footer{width:55%;font-size:1.1rem;text-align:right;}section>p,section>footer,section>table{width:55%;}section>ol,section>ul{width:50%;-webkit-padding-start:5%;}li:not(:first-child){margin-top:0.25rem;}figure{padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline;max-width:55%;-webkit-margin-start:0;-webkit-margin-end:0;margin:0 0 3em 0;}figcaption{float:right;clear:right;margin-top:0;margin-bottom:0;font-size:1.1rem;line-height:1.6;vertical-align:baseline;position:relative;max-width:40%;}figure.fullwidth figcaption{margin-right:24%;}a:link,a:visited{color:inherit;}a:link{-webkit-text-decoration:none;text-decoration:none;background:-webkit-linear-gradient(#fffff8,#fffff8), -webkit-linear-gradient(#fffff8,#fffff8), -webkit-linear-gradient(#333,#333);background:linear-gradient(#fffff8,#fffff8), linear-gradient(#fffff8,#fffff8),linear-gradient(#333,#333);-webkit-background-size:0.05em 1px,0.05em 1px,1px 1px;-moz-background-size:0.05em 1px,0.05em 1px,1px 1px;background-size:0.05em 1px,0.05em 1px,1px 1px;background-repeat:no-repeat,no-repeat,repeat-x;text-shadow:0.03em 0 #fffff8,-0.03em 0 #fffff8,0 0.03em #fffff8, 0 -0.03em #fffff8,0.06em 0 #fffff8,-0.06em 0 #fffff8, 0.09em 0 #fffff8,-0.09em 0 #fffff8,0.12em 0 #fffff8, -0.12em 0 #fffff8,0.15em 0 #fffff8,-0.15em 0 #fffff8;background-position:0% 93%,100% 93%,0% 93%;}@media screen and (-webkit-min-device-pixel-ratio:0){a:link{background-position-y:87%,87%,87%;}}a:link::selection{text-shadow:0.03em 0 #b4d5fe,-0.03em 0 #b4d5fe,0 0.03em #b4d5fe, 0 -0.03em #b4d5fe,0.06em 0 #b4d5fe,-0.06em 0 #b4d5fe, 0.09em 0 #b4d5fe,-0.09em 0 #b4d5fe,0.12em 0 #b4d5fe, -0.12em 0 #b4d5fe,0.15em 0 #b4d5fe,-0.15em 0 #b4d5fe;background:#b4d5fe;}a:link::-moz-selection{text-shadow:0.03em 0 #b4d5fe,-0.03em 0 #b4d5fe,0 0.03em #b4d5fe, 0 -0.03em #b4d5fe,0.06em 0 #b4d5fe,-0.06em 0 #b4d5fe, 0.09em 0 #b4d5fe,-0.09em 0 #b4d5fe,0.12em 0 #b4d5fe, -0.12em 0 #b4d5fe,0.15em 0 #b4d5fe,-0.15em 0 #b4d5fe;background:#b4d5fe;}img{max-width:100%;}.sidenote,.marginnote{float:right;clear:right;margin-right:-60%;width:50%;margin-top:0;margin-bottom:0;font-size:1.1rem;line-height:1.3;vertical-align:baseline;position:relative;}.sidenote-number{counter-increment:sidenote-counter;}.sidenote-number:after,.sidenote:before{font-family:et-book-roman-old-style;position:relative;vertical-align:baseline;}.sidenote-number:after{content:counter(sidenote-counter);font-size:1rem;top:-0.5rem;left:0.1rem;}.sidenote:before{content:counter(sidenote-counter) " ";font-size:1rem;top:-0.5rem;}blockquote .sidenote,blockquote .marginnote{margin-right:-82%;min-width:59%;text-align:left;}div.fullwidth,table.fullwidth{width:100%;}div.table-wrapper{overflow-x:auto;font-family:"Trebuchet MS","Gill Sans","Gill Sans MT",sans-serif;}.sans{font-family:"Gill Sans","Gill Sans MT",Calibri,sans-serif;-webkit-letter-spacing:0.03em;-moz-letter-spacing:0.03em;-ms-letter-spacing:0.03em;letter-spacing:0.03em;}code{font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:1rem;line-height:1.42;}.sans>code{font-size:1.2rem;}h1>code,h2>code,h3>code{font-size:0.8em;}.marginnote>code,.sidenote>code{font-size:1rem;}pre.code{font-size:0.9rem;width:52.5%;margin-left:2.5%;overflow-x:auto;}pre.code.fullwidth{width:90%;}article p{max-width:90%;clear:both;}.fullwidth{max-width:90%;clear:both;}span.newthought{font-variant:small-caps;font-size:1.2em;}input.margin-toggle{display:none;}label.sidenote-number{display:inline;}label.margin-toggle:not(.sidenote-number){display:none;}.iframe-wrapper{position:relative;padding-bottom:56.25%;padding-top:25px;height:0;}.iframe-wrapper iframe{position:absolute;top:0;left:0;width:100%;height:100%;}@media (max-width:760px){body{width:84%;padding-left:8%;padding-right:8%;}hr,section>p,section>footer,section>table{width:100%;}pre.code{width:97%;}section>ol{width:90%;}section>ul{width:90%;}figure{max-width:90%;}figcaption,figure.fullwidth figcaption{margin-right:0%;max-width:none;}blockquote{margin-left:1.5em;margin-right:0em;}blockquote p,blockquote footer{width:100%;}label.margin-toggle:not(.sidenote-number){display:inline;}.sidenote,.marginnote{display:none;}.margin-toggle:checked+.sidenote,.margin-toggle:checked+.marginnote{display:block;float:left;left:1rem;clear:both;width:95%;margin:1rem 2.5%;vertical-align:baseline;position:relative;}label{cursor:pointer;}div.table-wrapper,table{width:85%;}img{width:100%;}}</style><style id="__jsx-2449690394">#blog-name{color:#dc322f;}@media (max-width:760px){article{padding:1em 0em;}}#TOC ol{width:auto;list-style-type:none;}</style></head><body><div id="__next"><div class="jsx-3021818034 page-layout"><header class="jsx-1504846400"><a href="/" class="jsx-1504846400">☰ <!-- -->Index</a></header><article><h1>HFS+ and Unicode madness</h1><time dateTime="2010-04-25"><h3>2010-04-25</h3></time><section><p><strong>This is an old post that I wrote some while ago, but never published it. It is here just for historical|nostalgic|unburdening reasons. Original post begins here:</strong></p>

<p>Annoying scenario: A file with unicode characters in its filename, like <code>Pétalo.java</code>:</p>
<script src="http://gist.github.com/489706.js?file=gistfile1.txt"></script>

<p>Why? That’s easy, because Mac OS X java wants everything with MacRoman encoding (<span class='caps'>WTF</span>??). Then I tried with the -encoding flag and tab-autocompletion for the filename:</p><br />
<script src="http://gist.github.com/489709.js?file=gistfile1.txt"></script><br />
<br />
<p>That is not good. When using autocompletion the filename is represented in <span class='caps'>NFD</span> or Normalization Form Canonical Decomposition (é =&gt; 65 cc81) but the class name in the file uses <span class='caps'>NFC</span> or Normalization Form Canonical Composition (é =&gt; c3a9). What a mess! Do you see the difference?:</p><script src="http://gist.github.com/489712.js?file=gistfile1.txt"></script><br />
<p>You can’t see the difference until you see the actual bytes of the string, and that’s why Apple tries to protect us by storing everything in the Filesystem with the same representation: <span class='caps'>NFD</span>. The first echo was done with autocompletion while the latter was typed directly with the keyboard. So if I compile the java sourcecode by fully typing the filename, it succeeds.</p><h3>¿What about version control?</h3><p>Then, this leads to a major problem. When someone in the world (including you and me) creates a file, he types its name with the keyboard, which as I have showed, it gives <span class='caps'>NFC</span> in Mac OS X. But with <span class='caps'>HFS</span>, the file is stored using <span class='caps'>NFD</span> and if you clone a git repo created in another OS you’ll see that you have untracked files without modifying anything!!</p><h3><span class='caps'>UFS</span> to the rescue (kind of…)</h3><p>Maybe you could say “well, just use another filesystem”, and I’ve done that, but it seems that Apple uses it’s decomposition algorithms everywhere.</p><p>First I tried <span class='caps'>ZFS</span> as I thought “That FS should work correctly in <span class='caps'>OSX</span>, they can’t spoil it”. But I installed the read-write implementation from MacOS Forge and it did the same stupid conversion (<span class='caps'>UPDATE</span>: <span class='caps'>ZFS</span> is discontinued in MacOS Forge :( ).</p><p><span class='caps'>FAT</span> is a no-no since it only accepts <span class='caps'>ASCII</span> characters for the filename and I don’t want to start a remote server nor a Virtual Machine every time I have to work with those files. This should work with my beloved OS!! And in fact, I have successfully made everything I’ve needed to work in Mac OS, until now :(.</p><p>So I needed to try <span class='caps'>UFS</span>, I looked at DiskUtility, but it doesn’t support <span class='caps'>UFS</span> and newfs fails to format my external <span class='caps'>USB</span> disk.</p><p>But since I used hdiutil to create Pallet’s dmg, I thought of havin a <span class='caps'>UFS</span> diskimage and guess what, you can!! This is the magic command:</p><script src="http://gist.github.com/489715.js?file=gistfile1.txt"></script><br />
<p>Now I can mount my dmg, compile and use git!!</p><p>But still there are two little problems:</p><ul><li>Snow Leopard doesn’t support <span class='caps'>UFS</span>. I can’t even mount my <span class='caps'>UFS</span> disk image :(</li>
<li>Every app that uses Cocoa to open files can’t read files with <span class='caps'>NFC</span> filenames. This means “forget about TextMate”. Noooooooo!!</li>
</ul><h3>Update</h3><p>Now I’ve updated to Snow Leopard and is very disappointing and sad that I have to use a virtual machine to do my job.</p><p>The good thing is that I can work with TextMate via ssh and MacFusion.</p><p>Bad things: MacOS X can solve my problem, I can’t open files with <span class='caps'>NFC</span> names in TextMate (but emacs.app still loves me) and although it seems there are some people working with File Systems at Apple I think this won’t be solved anytime soon.</p>
</section><footer><h3>– Juan German Castañeda Echevarría</h3></footer></article><footer><section><div class="fullwidth" id="disqus_thread"></div></section><script>
              /**
              *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
              *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
              
              var disqus_config = function () {
                this.page.url = 'http://blog.juanger.com/en/2010/04/this-is-old-post-that-i-wrote-some';  // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = 'en/2010-04-25/this-is-old-post-that-i-wrote-some'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                this.language = 'en_US';
              };
              
              (function() { // DON'T EDIT BELOW THIS LINE
              var d = document, s = d.createElement('script');
              s.src = 'https://xocoruby.disqus.com/embed.js';
              s.setAttribute('data-timestamp', +new Date());
              (d.head || d.body).appendChild(s);
              })();
            </script><noscript>Please enable JavaScript to view the<!-- --> <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"HFS+ and Unicode madness","contents":"\u003cp\u003e\u003cstrong\u003eThis is an old post that I wrote some while ago, but never published it. It is here just for historical|nostalgic|unburdening reasons. Original post begins here:\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eAnnoying scenario: A file with unicode characters in its filename, like \u003ccode\u003ePétalo.java\u003c/code\u003e:\u003c/p\u003e\n\u003cscript src=\"http://gist.github.com/489706.js?file=gistfile1.txt\"\u003e\u003c/script\u003e\n\n\u003cp\u003eWhy? That’s easy, because Mac OS X java wants everything with MacRoman encoding (\u003cspan class='caps'\u003eWTF\u003c/span\u003e??). Then I tried with the -encoding flag and tab-autocompletion for the filename:\u003c/p\u003e\u003cbr /\u003e\n\u003cscript src=\"http://gist.github.com/489709.js?file=gistfile1.txt\"\u003e\u003c/script\u003e\u003cbr /\u003e\n\u003cbr /\u003e\n\u003cp\u003eThat is not good. When using autocompletion the filename is represented in \u003cspan class='caps'\u003eNFD\u003c/span\u003e or Normalization Form Canonical Decomposition (é =\u0026gt; 65 cc81) but the class name in the file uses \u003cspan class='caps'\u003eNFC\u003c/span\u003e or Normalization Form Canonical Composition (é =\u0026gt; c3a9). What a mess! Do you see the difference?:\u003c/p\u003e\u003cscript src=\"http://gist.github.com/489712.js?file=gistfile1.txt\"\u003e\u003c/script\u003e\u003cbr /\u003e\n\u003cp\u003eYou can’t see the difference until you see the actual bytes of the string, and that’s why Apple tries to protect us by storing everything in the Filesystem with the same representation: \u003cspan class='caps'\u003eNFD\u003c/span\u003e. The first echo was done with autocompletion while the latter was typed directly with the keyboard. So if I compile the java sourcecode by fully typing the filename, it succeeds.\u003c/p\u003e\u003ch3\u003e¿What about version control?\u003c/h3\u003e\u003cp\u003eThen, this leads to a major problem. When someone in the world (including you and me) creates a file, he types its name with the keyboard, which as I have showed, it gives \u003cspan class='caps'\u003eNFC\u003c/span\u003e in Mac OS X. But with \u003cspan class='caps'\u003eHFS\u003c/span\u003e, the file is stored using \u003cspan class='caps'\u003eNFD\u003c/span\u003e and if you clone a git repo created in another OS you’ll see that you have untracked files without modifying anything!!\u003c/p\u003e\u003ch3\u003e\u003cspan class='caps'\u003eUFS\u003c/span\u003e to the rescue (kind of…)\u003c/h3\u003e\u003cp\u003eMaybe you could say “well, just use another filesystem”, and I’ve done that, but it seems that Apple uses it’s decomposition algorithms everywhere.\u003c/p\u003e\u003cp\u003eFirst I tried \u003cspan class='caps'\u003eZFS\u003c/span\u003e as I thought “That FS should work correctly in \u003cspan class='caps'\u003eOSX\u003c/span\u003e, they can’t spoil it”. But I installed the read-write implementation from MacOS Forge and it did the same stupid conversion (\u003cspan class='caps'\u003eUPDATE\u003c/span\u003e: \u003cspan class='caps'\u003eZFS\u003c/span\u003e is discontinued in MacOS Forge :( ).\u003c/p\u003e\u003cp\u003e\u003cspan class='caps'\u003eFAT\u003c/span\u003e is a no-no since it only accepts \u003cspan class='caps'\u003eASCII\u003c/span\u003e characters for the filename and I don’t want to start a remote server nor a Virtual Machine every time I have to work with those files. This should work with my beloved OS!! And in fact, I have successfully made everything I’ve needed to work in Mac OS, until now :(.\u003c/p\u003e\u003cp\u003eSo I needed to try \u003cspan class='caps'\u003eUFS\u003c/span\u003e, I looked at DiskUtility, but it doesn’t support \u003cspan class='caps'\u003eUFS\u003c/span\u003e and newfs fails to format my external \u003cspan class='caps'\u003eUSB\u003c/span\u003e disk.\u003c/p\u003e\u003cp\u003eBut since I used hdiutil to create Pallet’s dmg, I thought of havin a \u003cspan class='caps'\u003eUFS\u003c/span\u003e diskimage and guess what, you can!! This is the magic command:\u003c/p\u003e\u003cscript src=\"http://gist.github.com/489715.js?file=gistfile1.txt\"\u003e\u003c/script\u003e\u003cbr /\u003e\n\u003cp\u003eNow I can mount my dmg, compile and use git!!\u003c/p\u003e\u003cp\u003eBut still there are two little problems:\u003c/p\u003e\u003cul\u003e\u003cli\u003eSnow Leopard doesn’t support \u003cspan class='caps'\u003eUFS\u003c/span\u003e. I can’t even mount my \u003cspan class='caps'\u003eUFS\u003c/span\u003e disk image :(\u003c/li\u003e\n\u003cli\u003eEvery app that uses Cocoa to open files can’t read files with \u003cspan class='caps'\u003eNFC\u003c/span\u003e filenames. This means “forget about TextMate”. Noooooooo!!\u003c/li\u003e\n\u003c/ul\u003e\u003ch3\u003eUpdate\u003c/h3\u003e\u003cp\u003eNow I’ve updated to Snow Leopard and is very disappointing and sad that I have to use a virtual machine to do my job.\u003c/p\u003e\u003cp\u003eThe good thing is that I can work with TextMate via ssh and MacFusion.\u003c/p\u003e\u003cp\u003eBad things: MacOS X can solve my problem, I can’t open files with \u003cspan class='caps'\u003eNFC\u003c/span\u003e names in TextMate (but emacs.app still loves me) and although it seems there are some people working with File Systems at Apple I think this won’t be solved anytime soon.\u003c/p\u003e\n","categories":[],"comments":false,"date":"2010-04-25","year":"2010","month":"04","slug":"this-is-old-post-that-i-wrote-some","lang":"en","hasTranslation":false},"__N_SSG":true},"page":"/[lang]/[year]/[month]/[slug]","query":{"lang":"blog","year":"2010","month":"04","slug":"this-is-old-post-that-i-wrote-some"},"buildId":"Zpr3ES4ezugP2oyXxdtgy","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-2622751f1b7992ef52a0.js"></script><script async="" data-next-page="/_app" src="/_next/static/Zpr3ES4ezugP2oyXxdtgy/pages/_app.js"></script><script async="" data-next-page="/[lang]/[year]/[month]/[slug]" src="/_next/static/Zpr3ES4ezugP2oyXxdtgy/pages/%5Blang%5D/%5Byear%5D/%5Bmonth%5D/%5Bslug%5D.js"></script><script src="/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="/_next/static/chunks/framework.c6faae2799416a6da8e8.js" async=""></script><script src="/_next/static/chunks/d6e0038b4b59f843086243a04f9222f0fd359ec2.2a93a51f7edfe8f800ec.js" async=""></script><script src="/_next/static/runtime/main-c9247a71228c59dea69a.js" async=""></script><script src="/_next/static/chunks/d4e48a365f993d8a349754363dd2b4104bb8c17a.9bf74a4d22fce6e7182f.js" async=""></script><script src="/_next/static/Zpr3ES4ezugP2oyXxdtgy/_buildManifest.js" async=""></script><script src="/_next/static/Zpr3ES4ezugP2oyXxdtgy/_ssgManifest.js" async=""></script></body></html>